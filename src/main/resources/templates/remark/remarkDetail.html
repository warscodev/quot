<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<div th:replace="fragments/topHeader :: topHeader"/>
<div th:replace="fragments/subHeader :: subHeader"/>
<div class="container container-custom">
    <div class="remark-page-wrap">
        </br>

        <div id="remark-scroll-position" class="py-2 d-flex" style="grid-template-columns: 1fr 2fr;">
        </div>

        <div class="row" id="remark-table-wrap">
            <div id="remark-table" th:object="${remark}">
                <div class="remark-row remark-detail-row">

                    <!-- 타이틀 -->
                    <div class="remark-detail-title-wrap">
                        <div><span class="remark-detail-title-date" th:text="${#temporals.format(remark.remarkDate,'yyyy년 MM월 dd일')}"></span></div>
                        <div class="d-flex"><h4 class="remark-detail-title-main" th:text="|${remark.person.job} ${remark.person.name}|"></h4><i class="bi bi-chat-quote-fill remark-detail-title-icon"></i></div>
                    </div>

                    <!-- 태그 -->
                    <div class="remark-first-row d-flex align-items-top">
                        <div class="remark-tag">
                            <a th:each="tagName : ${remark.tags}"
                               th:href="@{/remark/search(keyword=${tagName.name},tab=3)}"><span
                                    th:text="|#${tagName.name}|"></span></a>
                        </div>
                    </div>

                    <!-- 발언 내용 -->
                    <div class="remark-content mt-2">
                        <pre><p th:text="*{content}"></p></pre>
                    </div>

                    <!-- 좋아요 버튼 -->
                    <div class="remark-center-bottom-wrap d-flex justify-content-center">
                        <!--좋아요-->
                        <div class="like-icon-container" style="margin-left: 0;">
                            <a class="btn"><i class="bi bi-hand-thumbs-up-fill like-icon" style='color: #439ff9;'></i><span class="like-count" style='color: #439ff9;'>102</span></a>
                        </div>
                        <!--싫어요-->
                        <div class="like-icon-container">
                            <a class="btn"><i class="bi bi-hand-thumbs-down-fill like-icon"></i><span class="like-count">5</span></a>
                        </div>
                    </div>

                    <!-- 하단 컨테이너(출처,공유,발언일,발언자 -->
                    <div class="d-flex justify-content-between align-items-center">
                        <!--좌측 하단-->
                        <div class="remark-source d-flex">
                            <!--출처-->
                            <a th:if="*{not #strings.isEmpty(sourceSort)}" th:href="*{sourceUrl}" target="_blank"
                               rel="noopener" th:inline="text">
                                <i class="bi bi-link-45deg"></i>[[*{sourceSort}]]</a>
                            <!--공유-->
                            <a class="share-btn" href="" th:onclick="|openShareModal(this, *{remarkId})|" data-bs-toggle="modal" th:data-name="*{person.name}"
                               th:data-date="*{#temporals.format(remarkDate,'yyyy.MM.dd')}" data-bs-target="#shareModal">
                                <i class="bi bi-box-arrow-up-right"></i> 공유</a>
                        </div>

                        <!--우측 하단-->
                        <div class="remark-right-bottom-wrap">

                            <!-- 발언인 검색-->
                            <div class="remark-detail-person-search d-flex align-items-center justify-content-end">
                                <a th:href="@{/remark/search(keyword=*{person.name},personId=*{person.id},tab=2)}">
                                    <span class="" th:text="*{person.name}"></span><span style="font-size: .8125rem; margin: 0 .25rem;">검색</span>
                                    <i class="bi bi-search remark-detail-person-search-icon"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- 등록,수정일 & 수정삭제버튼 -->
                    <div class="d-flex justify-content-between pt-2"
                         style="border-top: 1px solid #eee; margin-top: 1rem;">

                        <div class="pt-1">
                            <!--등록일-->
                            <div class="col-xs-6">
                                <span><small class="text-muted" th:text="|등록 : *{createdDate}|"></small></span>
                            </div>
                            <!--수정일-->
                            <div class="col-xs-6">
                                <span><small class="text-muted" th:text="|수정 : *{createdDate}|"></small></span>
                            </div>
                        </div>

                        <div th:if="${user!=null && user.role.toString().equals('ADMIN')}" class="remark-delete-and-update-btn-wrap d-flex align-items-center">
                            <!-- 수정 버튼 -->
                            <a class="btn btn-outline-secondary btn-sm me-2"
                               th:href="@{/remark/{remarkId}/update(remarkId=*{remarkId})}">수정</a>
                            <!-- 삭제 버튼 -->
                            <button class="btn btn-outline-danger btn-sm btn-delete"
                                    th:onclick="|deleteRemark(*{remarkId})|">삭제
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="d-flex justify-content-end" style="margin-bottom: 1rem;">
                <a class="btn btn-outline-secondary btn-sm" href="javascript:toList();">목록</a>
        </div>
    </div>
</div>
</div>
<!-- Modal -->
<div th:replace="fragments/shareModal :: shareModal"/>
<div th:replace="fragments/footer :: footer"/>
<script>
    function deleteRemark(id) {
        if (confirm("정말 삭제하시겠습니까? \n삭제한 발언은 복원할 수 없습니다.") == true) {
            $.ajax({
                type: 'DELETE',
                url: '/api/remark/' + id,
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
            }).done(function () {
                alert('발언이 삭제되었습니다.');
                history.back();
            }).fail(function (error) {
                alert(JSON.stringify(error));
            });
        } else {
            return;
        }
    }
</script>
<script>
    function toList(){
        window.location.href = '/remark';
        /*if(history.state != null && history.state.page){
            history.back();
        }else {
            window.location.href = '/remark';
        }*/
    }
</script>
</body>
</html>