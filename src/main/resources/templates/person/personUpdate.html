<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<html xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:replace="fragments/header :: header(title=|${info.name} : 인물정보 수정|, content=|${info.name}의 정보 수정 페이지입니다.|)">
<body th:object="${info}">
<div th:replace="fragments/loginHeader :: loginHeader"></div>
<div th:replace="fragments/topHeader :: topHeader"></div>
<div th:replace="fragments/subNavbar :: subNavbar"></div>
<div class="container-xl person-detail-container">
    <div class="row">
        <form class="col-lg-8" method="post" enctype="multipart/form-data">
            <div class="p-d-header-container">
                <div>
                    <div class="p-d-header d-flex justify-content-between">
                        <div class="p-d-header-row-container d-sm-flex align-items-top">
                            <div class="p-d-profile-icon-container text-center">
                                <div class="p-u-image-preview-wrap p-u">
                                    <img th:if="*{image != null && !#strings.isEmpty(image)}" th:src="*{image}" id="preview-image" alt="사진">
                                    <img th:unless="*{image != null && !#strings.isEmpty(image)}" src="/css/images/basic_image.svg" id="preview-image" alt="사진">
                                    <input type="hidden" th:field="*{image}">
                                </div>
                                <div class="d-flex justify-content-center mt-2">
                                    <!--<button type="button" class="p-u-image-upload-button btn btn-sm"
                                            data-bs-toggle="modal" data-bs-target="#imageUploadModal">편집
                                    </button>-->
                                    <label class="p-u-image-upload-btn btn btn-sm" for="p-u-file-upload-input">업로드</label>
                                    <input type="file" id="p-u-file-upload-input" style="display: none;" name="multipartFile">
                                </div>
                                <div>
                                    <button type="button" class="p-u-image-reset-btn btn btn-sm">기본 이미지로 변경</button>
                                </div>
                                <div class="p-u-file-name-container">
                                    <span class="p-u-file-name-input"></span>
                                </div>
                            </div>
                            <div class="p-d-info-container p-u">
                                <div class="d-flex">
                                    <div class="me-3">
                                        <label class="form-label" th:for="name">이름</label>
                                        <input type="text"
                                               th:class="${#fields.hasErrors('name')}? 'p-u-name form-control form-control-sm fieldError' : 'form-control form-control-sm p-u-name'"
                                               th:field="*{name}"/>
                                    </div>
                                    <div>
                                        <label class="form-label" th:for="category">카테고리</label>
                                        <select class="form-select form-select-sm"
                                                th:field="*{category}">
                                            <option th:value="기타">카테고리</option>
                                            <option th:value="정치">정치</option>
                                            <option th:value="방송연예">방송/연예</option>
                                            <option th:value="사회문화">사회/문화</option>
                                            <option th:value="스포츠">스포츠</option>
                                            <option th:value="창작물">창작물</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-flex mb-4 flex-wrap flex-sm-nowrap">
                                    <div class="me-3 mt-3">
                                        <label class="form-label" th:for="alias">본명, 예명</label>
                                        <input type="text" class="p-d-alias form-control form-control-sm"
                                               th:field="*{alias}" placeholder="콤마(,)로 구분"/>
                                    </div>

                                    <div class="me-3 mt-3">
                                        <label class="form-label" th:for="job">직업</label>
                                        <input type="text" class="p-d-job form-control form-control-sm"
                                               th:field="*{job}"/>
                                    </div>
                                    <div class="mt-3">
                                        <label class="form-label" th:for="organization">소속</label>
                                        <input type="text" class="p-d-job form-control form-control-sm"
                                               th:field="*{organization}"/>
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label" th:for="birth.birth_year">출생</label>
                                    <div class="p-d-birth-input-container d-flex mb-4">
                                        <div class="d-flex align-items-center me-2">
                                            <input class="form-control form-control-sm" placeholder="(4자)"
                                                   type="number" th:field="*{birth.birth_year}" maxlength="4"
                                                   min="0" oninput="yearMaxLength(this);"><span
                                                class="birth-text">년</span>
                                        </div>
                                        <div class="d-flex align-items-center me-2">
                                            <input class="form-control form-control-sm" placeholder=""
                                                   type="number" th:field="*{birth.birth_month}" maxlength="2"
                                                   min="0" oninput="monthMaxLength(this)"/><span
                                                class="birth-text">월</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <input class="form-control form-control-sm" placeholder=""
                                                   type="number" th:field="*{birth.birth_day}" maxlength="2" min="0"
                                                   oninput="dayMaxLength(this);"/><span class="birth-text">일</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label">기타</label>
                                    <textarea class="form-control form-control-sm"
                                              th:field="*{summary}"
                                              rows="5"></textarea>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-2">
                <div class="d-flex float-end me-2">
                    <button type="submit" class="btn btn-primary btn-sm me-md-2">저장</button>
                    <a href="javascript:history.back();" class="btn btn-outline-secondary btn-sm">취소</a>
                </div>
        </form>
        <div>
            <form class="float-left" th:action="@{/admin/person/{id}/delete (id=*{id.toString()})}" method="post"
                  onsubmit="return confirm('정말 삭제하시겠습니까? \n인물 정보를 삭제하는 경우, 해당 인물의 모든 발언 또한 삭제되고\n복원할 수 없습니다.');">
                <button type="submit" class="btn btn-danger btn-sm ms-2" id="btn-delete">삭제</button>
            </form>
        </div>
    </div>
    <div th:replace="fragments/aside :: aside"></div>

</div>
<div th:replace="fragments/imageUploadModal :: imageUploadModal"></div>
<div th:replace="fragments/footer :: footer"></div>
</body>
<script>
    function renderImage(input){
        // 인풋 태그에 파일이 있는 경우
        if(input.files && input.files[0]) {
            // 이미지 파일인지 검사 (생략)
            // FileReader 인스턴스 생성
            const reader = new FileReader()
            // 이미지가 로드가 된 경우
            reader.onload = e => {
                const previewImage = document.getElementById("preview-image")
                previewImage.src = e.target.result
            }
            // reader가 이미지 읽도록 하기
            reader.readAsDataURL(input.files[0])
            printFileName(input.files[0]);
        }
    }

    function printFileName(file){
        let fileName = file.name;
        const fileNameInput = document.querySelector(".p-u-file-name-input");
        if (fileName.length >10){
            fileNameInput.innerText = fileName.substr(0,7)+".."+fileName.substring(fileName.lastIndexOf("."));
        }else {
            fileNameInput.innerText = fileName;
        }
        fileNameInput.setAttribute("title",fileName);
    }

    function resetImage(){
        let imageHiddenInput = document.getElementById("image");
        fileInput.value = '';
        imageHiddenInput.value = '';
        const previewImage = document.getElementById("preview-image");
        previewImage.src = '/css/images/basic_image.svg';
    }

    const resetBtn = document.querySelector(".p-u-image-reset-btn");
    resetBtn.addEventListener("click", resetImage);

    const fileInput = document.getElementById("p-u-file-upload-input");
    fileInput.addEventListener("change", e => {
        renderImage(e.target);
    })

</script>
<script type="text/javascript" th:src="@{/js/admin/person/person.js}"></script>
</html>