<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div class="shareModal" th:fragment="shareModal">
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title share-modal-title" id="shareModalLabel">ê³µìœ í•˜ê¸°</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row justify-content-center">
                        <inpu id="remark-share-modal-name" type="hidden"></inpu>
                        <inpu id="remark-share-modal-date" type="hidden"></inpu>
                        <div class="col-auto remark-share-icon">
                            <a id="kakaoShareBtn" class="kakao" href="javascript:;">
                                <img src="/css/images/kakaotalk_logo.png">
                                <div>ì¹´ì¹´ì˜¤í†¡</div>
                            </a>
                        </div>
                        <div class="col-auto remark-share-icon">
                            <a class="facebook" href="javascript:shareFacebook();">
                                <img src="/css/images/facebook_logo.png">
                                <div>í˜ì´ìŠ¤ë¶</div>
                            </a>
                        </div>
                        <div class="col-auto remark-share-icon">
                            <a class="twitter" href="javascript:shareTwitter();">
                                <img src="/css/images/twitter_logo.png">
                                <div>íŠ¸ìœ„í„°</div>
                            </a>
                        </div>
                    </div>
                    <div class="input-group mt-3 mb-3 remark-share-url-wrap">
                        <input id="remark-share-url" type="text" class="form-control" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="copyUrl()">
                            ë³µì‚¬
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script>
        const urlInput = document.getElementById("remark-share-url");
        let name = '',
            date = '',
            index = '',
            content = '';

        Kakao.init('d98279dd490fad82032e7f644c8af31c');

        function openShareModal(e, id) {
            urlInput.value = `https://quot.wiki/remark/${id}`;

            name = e.dataset.name;
            date = e.dataset.date;
            index = e.dataset.index;
            content = document.getElementById("remark-content-"+index).innerText;

            shareKakao();
        }

        function copyUrl() {

            const oldContentEditable = urlInput.contentEditable,
                oldReadOnly = urlInput.readOnly,
                range = document.createRange();

            urlInput.contentEditable = "true";
            urlInput.readOnly = false;
            range.selectNodeContents(urlInput);

            const s = window.getSelection();
            s.removeAllRanges();
            s.addRange(range);

            urlInput.select();
            urlInput.setSelectionRange(0, 999999);

            urlInput.contentEditable = oldContentEditable;
            urlInput.readOnly = oldReadOnly;

            document.execCommand("copy");

            alert("ì£¼ì†Œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function shareTwitter() {
            let contentForSend = '';
            if(content.length > 80){
                contentForSend = "\"" + content.substr(0,80) + "...\" - ë”ë³´ê¸°ğŸ‘‰";
            }else{
                contentForSend = "\"" + content + "\" ğŸ‘‰";
            }

            let sendText = date + ". " + name + " ë°œì–¸ " + contentForSend;
            window.open("https://twitter.com/intent/tweet?text=" + sendText + "&hashtags=ì¿¼íŠ¸ìœ„í‚¤,"+ name +"&url=" + urlInput.value);
        }

        function shareFacebook() {
            window.open("http://www.facebook.com/sharer/sharer.php?u=" + urlInput.value);
        }


        function shareKakao() {

            // ì¹´ì¹´ì˜¤ë§í¬ ë²„íŠ¼ ìƒì„±
            Kakao.Link.createDefaultButton({
                container: '#kakaoShareBtn',
                objectType: 'feed',
                content: {
                    title: name + " ë°œì–¸ | "+date+" - ì¿¼íŠ¸ìœ„í‚¤",
                    description: "\""+content+"\"",
                    imageUrl: 'https://quot.wiki/css/images/logo.png',
                    link: {
                        mobileWebUrl: urlInput.value,
                        webUrl: urlInput.value
                    }
                },
                buttons:
                    {
                        title:"ìì„¸íˆ ë³´ê¸°",
                        link: {
                            mobileWebUrl: urlInput.value,
                            webUrl: urlInput.value
                        }
                    }
            });
        }
    </script>

</div>

